OBJECT Page 5872 BOM Cost Shares
{
  OBJECT-PROPERTIES
  {
    Date=26/09/17;
    Time=12:00:00;
    Version List=NAVW110.00.00.18609;
  }
  PROPERTIES
  {
    CaptionML=[ENU=BOM Cost Shares;
               ENG=BOM Cost Shares];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    SourceTable=Table5870;
    PageType=Worksheet;
    SourceTableTemporary=Yes;
    OnOpenPage=BEGIN
                 RefreshPage;
               END;

    OnAfterGetRecord=VAR
                       DummyBOMWarningLog@1000 : Record 5874;
                     BEGIN
                       IsParentExpr := NOT "Is Leaf";

                       HasWarning := NOT IsLineOk(FALSE,DummyBOMWarningLog);
                     END;

    ActionList=ACTIONS
    {
      { 29      ;0   ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 28      ;1   ;Action    ;
                      CaptionML=[ENU=Show Warnings;
                                 ENG=Show Warnings];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=ErrorLog;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ShowWarningsForAllLines;
                               END;
                                }
      { 45      ;0   ;ActionContainer;
                      ActionContainerType=Reports }
      { 42      ;1   ;Action    ;
                      CaptionML=[ENU=BOM Cost Share Distribution;
                                 ENG=BOM Cost Share Distribution];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Report;
                      PromotedCategory=Report;
                      OnAction=BEGIN
                                 ShowBOMCostShareDistribution;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;0   ;Container ;
                ContainerType=ContentArea }

    { 20  ;1   ;Group     ;
                CaptionML=[ENU=Option;
                           ENG=Option];
                GroupType=GridLayout }

    { 19  ;2   ;Field     ;
                CaptionML=[ENU=Item Filter;
                           ENG=Item Filter];
                ToolTipML=[ENU=Specifies the items shown in the BOM Cost Shares window.;
                           ENG=Specifies the items shown in the BOM Cost Shares window.];
                SourceExpr=ItemFilter;
                OnValidate=BEGIN
                             RefreshPage;
                           END;

                OnLookup=VAR
                           Item@1001 : Record 27;
                           ItemList@1000 : Page 31;
                         BEGIN
                           ItemList.SETTABLEVIEW(Item);
                           ItemList.LOOKUPMODE := TRUE;
                           IF ItemList.RUNMODAL = ACTION::LookupOK THEN BEGIN
                             ItemList.GETRECORD(Item);
                             Text := Item."No.";
                             EXIT(TRUE);
                           END;
                           EXIT(FALSE);
                         END;
                          }

    { 2   ;1   ;Group     ;
                Name=Group;
                CaptionML=[ENU=Lines;
                           ENG=Lines];
                IndentationColumnName=Indentation;
                ShowAsTree=Yes;
                GroupType=Repeater }

    { 26  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's position in the BOM hierarchy. Lower-level items are indented under their parents.;
                           ENG=Specifies the item's position in the BOM hierarchy. Lower-level items are indented under their parents.];
                SourceExpr=Type }

    { 4   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the item.;
                           ENG=Specifies the number of the item.];
                SourceExpr="No.";
                Editable=FALSE;
                Style=Strong;
                StyleExpr=IsParentExpr }

    { 14  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's description.;
                           ENG=Specifies the item's description.];
                SourceExpr=Description;
                Editable=FALSE;
                Style=Strong;
                StyleExpr=IsParentExpr }

    { 30  ;2   ;Field     ;
                CaptionML=[ENU=Warning;
                           ENG=Warning];
                ToolTipML=[ENU=Specifies if the BOM line has setup or data issues.;
                           ENG=Specifies if the BOM line has setup or data issues.];
                BlankZero=Yes;
                SourceExpr=HasWarning;
                Editable=FALSE;
                Style=Attention;
                StyleExpr=HasWarning;
                OnDrillDown=BEGIN
                              IF HasWarning THEN
                                ShowWarnings;
                            END;
                             }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the variant code that you entered in the Variant Filter field in the Item Availability by BOM Level window.;
                           ENG=Specifies the variant code that you entered in the Variant Filter field in the Item Availability by BOM Level window.];
                SourceExpr="Variant Code";
                Visible=FALSE }

    { 21  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies how many units of the component are required to assemble or produce one unit of the parent.;
                           ENG=Specifies how many units of the component are required to assemble or produce one unit of the parent.];
                DecimalPlaces=0:5;
                SourceExpr="Qty. per Parent" }

    { 22  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies how many units of the component are required to assemble or produce one unit of the top item.;
                           ENG=Specifies how many units of the component are required to assemble or produce one unit of the top item.];
                DecimalPlaces=0:5;
                SourceExpr="Qty. per Top Item";
                Editable=FALSE }

    { 18  ;2   ;Field     ;
                BlankZero=Yes;
                SourceExpr="Qty. per BOM Line";
                Editable=FALSE }

    { 23  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's unit of measure.;
                           ENG=Specifies the item's unit of measure.];
                SourceExpr="Unit of Measure Code";
                Editable=FALSE }

    { 3   ;2   ;Field     ;
                SourceExpr="BOM Unit of Measure Code";
                Editable=FALSE }

    { 24  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's replenishment system.;
                           ENG=Specifies the item's replenishment system.];
                SourceExpr="Replenishment System";
                Editable=FALSE }

    { 13  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the sum of the individual cost shares.;
                           ENG=Specifies the sum of the individual cost shares.];
                BlankZero=Yes;
                SourceExpr="Unit Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 27  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the percentage of the parent item that you expect to be scrapped in the production process.;
                           ENG=Specifies the percentage of the parent item that you expect to be scrapped in the production process.];
                SourceExpr="Scrap %";
                Visible=FALSE }

    { 31  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies how many units of the item are scrapped to output the top item quantity.;
                           ENG=Specifies how many units of the item are scrapped to output the top item quantity.];
                SourceExpr="Scrap Qty. per Parent";
                Visible=FALSE }

    { 32  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies how many units of the item are scrapped to output the parent item quantity.;
                           ENG=Specifies how many units of the item are scrapped to output the parent item quantity.];
                SourceExpr="Scrap Qty. per Top Item";
                Visible=FALSE }

    { 15  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the indirect cost percent of the item or resource.;
                           ENG=Specifies the indirect cost percent of the item or resource.];
                BlankZero=Yes;
                SourceExpr="Indirect Cost %";
                Visible=FALSE;
                Editable=FALSE }

    { 11  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's overhead rate.;
                           ENG=Specifies the item's overhead rate.];
                BlankZero=Yes;
                SourceExpr="Overhead Rate";
                Visible=FALSE;
                Editable=FALSE }

    { 10  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's lot size. The value is copied from the Lot Size field on the item card.;
                           ENG=Specifies the item's lot size. The value is copied from the Lot Size field on the item card.];
                SourceExpr="Lot Size";
                Visible=FALSE }

    { 16  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's production BOM number.;
                           ENG=Specifies the item's production BOM number.];
                SourceExpr="Production BOM No.";
                Visible=FALSE }

    { 17  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the item's production order routing.;
                           ENG=Specifies the number of the item's production order routing.];
                SourceExpr="Routing No.";
                Visible=FALSE }

    { 35  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies how the cost of the resource on the assembly BOM is allocated during assembly.;
                           ENG=Specifies how the cost of the resource on the assembly BOM is allocated during assembly.];
                SourceExpr="Resource Usage Type";
                Visible=FALSE }

    { 34  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the material cost of all items at all levels of the parent item's BOM, added to the material cost of the item itself.;
                           ENG=Specifies the material cost of all items at all levels of the parent item's BOM, added to the material cost of the item itself.];
                SourceExpr="Rolled-up Material Cost" }

    { 36  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the capacity costs related to the item's parent item and other items in the parent item's BOM.;
                           ENG=Specifies the capacity costs related to the item's parent item and other items in the parent item's BOM.];
                SourceExpr="Rolled-up Capacity Cost" }

    { 37  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the single-level cost of outsourcing operations to a subcontractor.;
                           ENG=Specifies the single-level cost of outsourcing operations to a subcontractor.];
                SourceExpr="Rolled-up Subcontracted Cost" }

    { 38  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item's overhead capacity cost rolled up from underlying item levels.;
                           ENG=Specifies the item's overhead capacity cost rolled up from underlying item levels.];
                SourceExpr="Rolled-up Mfg. Ovhd Cost" }

    { 39  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the rolled-up manufacturing overhead cost of the item.;
                           ENG=Specifies the rolled-up manufacturing overhead cost of the item.];
                SourceExpr="Rolled-up Capacity Ovhd. Cost" }

    { 40  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the cost of all component material that will eventually be scrapped to produce the parent item.;
                           ENG=Specifies the cost of all component material that will eventually be scrapped to produce the parent item.];
                SourceExpr="Rolled-up Scrap Cost" }

    { 12  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the total material cost of all components on the parent item's BOM.;
                           ENG=Specifies the total material cost of all components on the parent item's BOM.];
                BlankZero=Yes;
                SourceExpr="Single-Level Material Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 8   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the capacity costs related to the item's parent item only.;
                           ENG=Specifies the capacity costs related to the item's parent item only.];
                BlankZero=Yes;
                SourceExpr="Single-Level Capacity Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 7   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the single-level cost of outsourcing operations to a subcontractor.;
                           ENG=Specifies the single-level cost of outsourcing operations to a subcontractor.];
                BlankZero=Yes;
                SourceExpr="Single-Level Subcontrd. Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 5   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the single-level capacity overhead cost.;
                           ENG=Specifies the single-level capacity overhead cost.];
                BlankZero=Yes;
                SourceExpr="Single-Level Cap. Ovhd Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 25  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the single-level manufacturing overhead cost.;
                           ENG=Specifies the single-level manufacturing overhead cost.];
                BlankZero=Yes;
                SourceExpr="Single-Level Mfg. Ovhd Cost";
                Visible=FALSE;
                Editable=FALSE }

    { 9   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the cost of material at this BOM level that will eventually be scrapped in order to produce the parent item.;
                           ENG=Specifies the cost of material at this BOM level that will eventually be scrapped in order to produce the parent item.];
                SourceExpr="Single-Level Scrap Cost";
                Visible=FALSE }

    { 33  ;2   ;Field     ;
                ToolTipML=[ENU=This field is intended for internal use.;
                           ENG=This field is intended for internal use.];
                SourceExpr="Total Cost" }

  }
  CODE
  {
    VAR
      Item@1004 : Record 27;
      AsmHeader@1009 : Record 900;
      ProdOrderLine@1002 : Record 5406;
      IsParentExpr@1010 : Boolean INDATASET;
      ItemFilter@1008 : Code[250];
      ShowBy@1005 : 'Item,Assembly,Production';
      Text000@1012 : TextConst 'ENU=None of the items in the filter have a BOM.;ENG=None of the items in the filter have a BOM.';
      Text001@1001 : TextConst 'ENU=There are no warnings.;ENG=There are no warnings.';
      HasWarning@1003 : Boolean INDATASET;

    PROCEDURE InitItem@1(VAR NewItem@1000 : Record 27);
    BEGIN
      Item.COPY(NewItem);
      ItemFilter := Item."No.";
      ShowBy := ShowBy::Item;
    END;

    PROCEDURE InitAsmOrder@5(NewAsmHeader@1000 : Record 900);
    BEGIN
      AsmHeader := NewAsmHeader;
      ShowBy := ShowBy::Assembly;
    END;

    PROCEDURE InitProdOrder@6(NewProdOrderLine@1000 : Record 5406);
    BEGIN
      ProdOrderLine := NewProdOrderLine;
      ShowBy := ShowBy::Production;
    END;

    LOCAL PROCEDURE RefreshPage@2();
    VAR
      CalcBOMTree@1000 : Codeunit 5870;
      HasBOM@1001 : Boolean;
    BEGIN
      Item.SETFILTER("No.",ItemFilter);
      Item.SETRANGE("Date Filter",0D,WORKDATE);
      CalcBOMTree.SetItemFilter(Item);

      CASE ShowBy OF
        ShowBy::Item:
          BEGIN
            Item.FINDSET;
            REPEAT
              HasBOM := Item.HasBOM OR (Item."Routing No." <> '')
            UNTIL HasBOM OR (Item.NEXT = 0);

            IF NOT HasBOM THEN
              ERROR(Text000);
            CalcBOMTree.GenerateTreeForItems(Item,Rec,2);
          END;
        ShowBy::Production:
          CalcBOMTree.GenerateTreeForProdLine(ProdOrderLine,Rec,2);
        ShowBy::Assembly:
          CalcBOMTree.GenerateTreeForAsm(AsmHeader,Rec,2);
      END;

      CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE ShowBOMCostShareDistribution@8();
    VAR
      Item@1001 : Record 27;
    BEGIN
      TESTFIELD(Type,Type::Item);

      Item.GET("No.");
      Item.SETFILTER("No.","No.");
      Item.SETFILTER("Variant Filter","Variant Code");
      IF ShowBy <> ShowBy::Item THEN
        Item.SETFILTER("Location Filter","Location Code");

      REPORT.RUN(REPORT::"BOM Cost Share Distribution",TRUE,TRUE,Item);
    END;

    LOCAL PROCEDURE ShowWarnings@10();
    VAR
      TempBOMWarningLog@1001 : TEMPORARY Record 5874;
    BEGIN
      IF IsLineOk(TRUE,TempBOMWarningLog) THEN
        MESSAGE(Text001)
      ELSE
        PAGE.RUNMODAL(PAGE::"BOM Warning Log",TempBOMWarningLog);
    END;

    LOCAL PROCEDURE ShowWarningsForAllLines@27();
    VAR
      TempBOMWarningLog@1001 : TEMPORARY Record 5874;
    BEGIN
      IF AreAllLinesOk(TempBOMWarningLog) THEN
        MESSAGE(Text001)
      ELSE
        PAGE.RUNMODAL(PAGE::"BOM Warning Log",TempBOMWarningLog);
    END;

    BEGIN
    END.
  }
}

