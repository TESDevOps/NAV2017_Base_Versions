OBJECT Page 5902 Service Order Subform
{
  OBJECT-PROPERTIES
  {
    Date=25/10/16;
    Time=12:00:00;
    Version List=NAVW110.00;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Lines;
               ENG=Lines];
    LinksAllowed=No;
    SourceTable=Table5901;
    DelayedInsert=Yes;
    SourceTableView=WHERE(Document Type=CONST(Order));
    PageType=ListPart;
    AutoSplitKey=Yes;
    OnOpenPage=BEGIN
                 ServMgtSetup.GET;
                 CASE ServMgtSetup."Fault Reporting Level" OF
                   ServMgtSetup."Fault Reporting Level"::None:
                     BEGIN
                       FaultAreaCodeVisible := FALSE;
                       SymptomCodeVisible := FALSE;
                       FaultCodeVisible := FALSE;
                       ResolutionCodeVisible := FALSE;
                     END;
                   ServMgtSetup."Fault Reporting Level"::Fault:
                     BEGIN
                       FaultAreaCodeVisible := FALSE;
                       SymptomCodeVisible := FALSE;
                       FaultCodeVisible := TRUE;
                       ResolutionCodeVisible := TRUE;
                     END;
                   ServMgtSetup."Fault Reporting Level"::"Fault+Symptom":
                     BEGIN
                       FaultAreaCodeVisible := FALSE;
                       SymptomCodeVisible := TRUE;
                       FaultCodeVisible := TRUE;
                       ResolutionCodeVisible := TRUE;
                     END;
                   ServMgtSetup."Fault Reporting Level"::"Fault+Symptom+Area (IRIS)":
                     BEGIN
                       FaultAreaCodeVisible := TRUE;
                       SymptomCodeVisible := TRUE;
                       FaultCodeVisible := TRUE;
                       ResolutionCodeVisible := TRUE;
                     END;
                 END;
               END;

    OnAfterGetRecord=BEGIN
                       IF "Serial No." = '' THEN
                         "No. of Previous Services" := 0;
                     END;

    OnNewRecord=BEGIN
                  SetUpNewLine;
                END;

    OnAfterGetCurrRecord=BEGIN
                           IF "Serial No." = '' THEN
                             "No. of Previous Services" := 0;
                         END;

    ActionList=ACTIONS
    {
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1907935204;1 ;ActionGroup;
                      CaptionML=[ENU=&Line;
                                 ENG=&Line];
                      Image=Line }
      { 1900296804;2 ;Action    ;
                      CaptionML=[ENU=Resource &Allocations;
                                 ENG=Resource &Allocations];
                      Image=ResourcePlanning;
                      OnAction=BEGIN
                                 AllocateResource;
                               END;
                                }
      { 1900545504;2 ;Action    ;
                      Name=Service Item Worksheet;
                      CaptionML=[ENU=Service &Item Worksheet;
                                 ENG=Service &Item Worksheet];
                      Image=ServiceItemWorksheet;
                      OnAction=BEGIN
                                 ShowServOrderWorksheet;
                               END;
                                }
      { 1901033504;2 ;Action    ;
                      CaptionML=[ENU=Troubleshooting;
                                 ENG=Troubleshooting];
                      Image=Troubleshoot;
                      OnAction=BEGIN
                                 ShowChecklist;
                               END;
                                }
      { 1900978604;2 ;Action    ;
                      Name=Fault/Resol. Codes Relations;
                      CaptionML=[ENU=&Fault/Resol. Codes Relationships;
                                 ENG=&Fault/Resol. Codes Relationships];
                      Image=FaultDefault;
                      OnAction=BEGIN
                                 SelectFaultResolutionCode;
                               END;
                                }
      { 1905427504;2 ;Action    ;
                      AccessByPermission=TableData 348=R;
                      ShortCutKey=Shift+Ctrl+D;
                      CaptionML=[ENU=Dimensions;
                                 ENG=Dimensions];
                      ToolTipML=[ENU=View or edit dimensions, such as area, project, or department, that you can assign to sales and purchase documents to distribute costs and analyze transaction history.;
                                 ENG=View or edit dimensions, such as area, project, or department, that you can assign to sales and purchase documents to distribute costs and analyse transaction history.];
                      Image=Dimensions;
                      OnAction=BEGIN
                                 ShowDimensions;
                               END;
                                }
      { 1901313504;2 ;ActionGroup;
                      CaptionML=[ENU=Co&mments;
                                 ENG=Co&mments];
                      Image=ViewComments }
      { 1901652704;3 ;Action    ;
                      CaptionML=[ENU=Faults;
                                 ENG=Faults];
                      Image=Error;
                      OnAction=BEGIN
                                 ShowComments(1);
                               END;
                                }
      { 1902759304;3 ;Action    ;
                      CaptionML=[ENU=Resolutions;
                                 ENG=Resolutions];
                      Image=Completed;
                      OnAction=BEGIN
                                 ShowComments(2);
                               END;
                                }
      { 1900207104;3 ;Action    ;
                      CaptionML=[ENU=Internal;
                                 ENG=Internal];
                      Image=Comment;
                      OnAction=BEGIN
                                 ShowComments(4);
                               END;
                                }
      { 1903099904;3 ;Action    ;
                      CaptionML=[ENU=Accessories;
                                 ENG=Accessories];
                      Image=ServiceAccessories;
                      OnAction=BEGIN
                                 ShowComments(3);
                               END;
                                }
      { 1901742304;3 ;Action    ;
                      CaptionML=[ENU=Lent Loaners;
                                 ENG=Lent Loaners];
                      OnAction=BEGIN
                                 ShowComments(5);
                               END;
                                }
      { 1901991404;2 ;Action    ;
                      CaptionML=[ENU=Service Item &Log;
                                 ENG=Service Item &Log];
                      Image=Log;
                      OnAction=BEGIN
                                 ShowServItemLog;
                               END;
                                }
      { 1906587504;1 ;ActionGroup;
                      CaptionML=[ENU=F&unctions;
                                 ENG=F&unctions];
                      Image=Action }
      { 1900206304;2 ;Action    ;
                      CaptionML=[ENU=Adjust Service Price;
                                 ENG=Adjust Service Price];
                      Image=PriceAdjustment;
                      OnAction=BEGIN
                                 CreatePriceAdjmt;
                               END;
                                }
      { 1902759704;2 ;Action    ;
                      CaptionML=[ENU=&Receive Loaner;
                                 ENG=&Receive Loaner];
                      Image=ReceiveLoaner;
                      OnAction=BEGIN
                                 ReceiveLoaner;
                               END;
                                }
      { 1907213204;2 ;Action    ;
                      Name=Create Service Item;
                      CaptionML=[ENU=Create Service &Item;
                                 ENG=Create Service &Item];
                      OnAction=BEGIN
                                 CreateServiceItem;
                               END;
                                }
      { 1901092004;2 ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Get St&d. Service Codes;
                                 ENG=Get St&d. Service Codes];
                      Image=ServiceCode;
                      OnAction=BEGIN
                                 GetStdServiceCodes;
                               END;
                                }
      { 1905926804;1 ;ActionGroup;
                      CaptionML=[ENU=O&rder;
                                 ENG=O&rder];
                      Image=Order }
      { 1901652204;2 ;Action    ;
                      Name=Service Lines;
                      ShortCutKey=Shift+Ctrl+I;
                      CaptionML=[ENU=Service Lin&es;
                                 ENG=Service Lin&es];
                      Image=ServiceLines;
                      OnAction=BEGIN
                                 RegisterServInvLines;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                GroupType=Repeater }

    { 4   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the line.;
                           ENG=Specifies the number of the line.];
                SourceExpr="Line No.";
                Visible=FALSE }

    { 6   ;2   ;Field     ;
                Name=ServiceItemNo;
                ToolTipML=[ENU=Specifies the service item number registered in the Service Item table.;
                           ENG=Specifies the service item number registered in the Service Item table.];
                SourceExpr="Service Item No.";
                OnLookup=VAR
                           ServOrderMgt@1000 : Codeunit 5900;
                         BEGIN
                           ServOrderMgt.LookupServItemNo(Rec);
                           IF xRec.GET("Document Type","Document No.","Line No.") THEN;
                         END;
                          }

    { 8   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the item number linked to this service item.;
                           ENG=Specifies the item number linked to this service item.];
                SourceExpr="Item No.";
                Visible=TRUE }

    { 48  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the code of the service item group for this item.;
                           ENG=Specifies the code of the service item group for this item.];
                SourceExpr="Service Item Group Code" }

    { 78  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the ship-to code of the service item associated with the service contract or service order.;
                           ENG=Specifies the ship-to code of the service item associated with the service contract or service order.];
                SourceExpr="Ship-to Code";
                Visible=FALSE }

    { 76  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the variant code for the item.;
                           ENG=Specifies the variant code for the item.];
                SourceExpr="Variant Code";
                Visible=FALSE }

    { 10  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the serial number of this item.;
                           ENG=Specifies the serial number of this item.];
                SourceExpr="Serial No.";
                OnAssistEdit=BEGIN
                               AssistEditSerialNo;
                             END;
                              }

    { 12  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies a description of this service item.;
                           ENG=Specifies a description of this service item.];
                SourceExpr=Description }

    { 50  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies an additional description of this item.;
                           ENG=Specifies an additional description of this item.];
                SourceExpr="Description 2";
                Visible=FALSE }

    { 46  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the repair status of this service item.;
                           ENG=Specifies the repair status of this service item.];
                SourceExpr="Repair Status Code" }

    { 14  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the service shelf this item is stored on.;
                           ENG=Specifies the number of the service shelf this item is stored on.];
                SourceExpr="Service Shelf No.";
                Visible=FALSE }

    { 16  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies that warranty on either parts or labor exists for this item.;
                           ENG=Specifies that warranty on either parts or labour exists for this item.];
                SourceExpr=Warranty }

    { 18  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the starting date of the spare parts warranty for this item.;
                           ENG=Specifies the starting date of the spare parts warranty for this item.];
                SourceExpr="Warranty Starting Date (Parts)";
                Visible=FALSE }

    { 20  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the ending date of the spare parts warranty for this item.;
                           ENG=Specifies the ending date of the spare parts warranty for this item.];
                SourceExpr="Warranty Ending Date (Parts)";
                Visible=FALSE }

    { 22  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the percentage of spare parts costs covered by the warranty for this item.;
                           ENG=Specifies the percentage of spare parts costs covered by the warranty for this item.];
                SourceExpr="Warranty % (Parts)";
                Visible=FALSE }

    { 24  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the percentage of labor costs covered by the warranty for this item.;
                           ENG=Specifies the percentage of labour costs covered by the warranty for this item.];
                SourceExpr="Warranty % (Labor)";
                Visible=FALSE }

    { 56  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the starting date of the labor warranty for this item.;
                           ENG=Specifies the starting date of the labour warranty for this item.];
                SourceExpr="Warranty Starting Date (Labor)";
                Visible=FALSE }

    { 58  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the ending date of the labor warranty for this item.;
                           ENG=Specifies the ending date of the labour warranty for this item.];
                SourceExpr="Warranty Ending Date (Labor)";
                Visible=FALSE }

    { 26  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the service contract associated with the item or service on the line.;
                           ENG=Specifies the number of the service contract associated with the item or service on the line.];
                SourceExpr="Contract No." }

    { 28  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the fault reason code for the item.;
                           ENG=Specifies the fault reason code for the item.];
                SourceExpr="Fault Reason Code";
                Visible=FALSE }

    { 36  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the code of the service price group associated with the item.;
                           ENG=Specifies the code of the service price group associated with the item.];
                SourceExpr="Service Price Group Code" }

    { 80  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the adjustment type for the line.;
                           ENG=Specifies the adjustment type for the line.];
                SourceExpr="Adjustment Type";
                Visible=FALSE }

    { 82  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the amount that the service line, linked to this service item line, will be adjusted to.;
                           ENG=Specifies the amount that the service line, linked to this service item line, will be adjusted to.];
                SourceExpr="Base Amount to Adjust";
                Visible=FALSE }

    { 40  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the fault area code for this item.;
                           ENG=Specifies the fault area code for this item.];
                SourceExpr="Fault Area Code";
                Visible=FaultAreaCodeVisible }

    { 42  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the symptom code for this item.;
                           ENG=Specifies the symptom code for this item.];
                SourceExpr="Symptom Code";
                Visible=SymptomCodeVisible }

    { 44  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the fault code for this item.;
                           ENG=Specifies the fault code for this item.];
                SourceExpr="Fault Code";
                Visible=FaultCodeVisible }

    { 60  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the resolution code for this item.;
                           ENG=Specifies the resolution code for this item.];
                SourceExpr="Resolution Code";
                Visible=ResolutionCodeVisible }

    { 38  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the service priority for this item.;
                           ENG=Specifies the service priority for this item.];
                SourceExpr=Priority }

    { 30  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the estimated hours from order creation, to the time when the repair status of the item line changes from Initial, to In Process.;
                           ENG=Specifies the estimated hours from order creation, to the time when the repair status of the item line changes from Initial, to In Process.];
                SourceExpr="Response Time (Hours)" }

    { 32  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the estimated date when service should start on this service item line.;
                           ENG=Specifies the estimated date when service should start on this service item line.];
                SourceExpr="Response Date" }

    { 34  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the estimated time when service should start on this service item.;
                           ENG=Specifies the estimated time when service should start on this service item.];
                SourceExpr="Response Time" }

    { 2   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the loaner that has been lent to the customer in the service order to replace this item.;
                           ENG=Specifies the number of the loaner that has been lent to the customer in the service order to replace this item.];
                SourceExpr="Loaner No.";
                LookupPageID=Available Loaners }

    { 52  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of the vendor of this item.;
                           ENG=Specifies the number of the vendor of this item.];
                SourceExpr="Vendor No.";
                Visible=FALSE }

    { 54  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number assigned to the service item by its vendor.;
                           ENG=Specifies the number assigned to the service item by its vendor.];
                SourceExpr="Vendor Item No.";
                Visible=FALSE }

    { 66  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the date when service on this item began and when the repair status changed to In process.;
                           ENG=Specifies the date when service on this item began and when the repair status changed to In process.];
                SourceExpr="Starting Date";
                Visible=FALSE }

    { 68  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the time when service on this item began and when the repair status changed to In process.;
                           ENG=Specifies the time when service on this item began and when the repair status changed to In process.];
                SourceExpr="Starting Time";
                Visible=FALSE }

    { 70  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the finishing date of the service and when the repair status of this item changes to Finished.;
                           ENG=Specifies the finishing date of the service and when the repair status of this item changes to Finished.];
                SourceExpr="Finishing Date";
                Visible=FALSE }

    { 72  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the finishing time of the service and when the repair status of this item changes to Finished.;
                           ENG=Specifies the finishing time of the service and when the repair status of this item changes to Finished.];
                SourceExpr="Finishing Time";
                Visible=FALSE }

    { 74  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of services performed on service items with the same item and serial number as this service item.;
                           ENG=Specifies the number of services performed on service items with the same item and serial number as this service item.];
                SourceExpr="No. of Previous Services" }

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=You cannot open the window because %1 is %2 in the %3 table.;ENG=You cannot open the window because %1 is %2 in the %3 table.';
      ServMgtSetup@1005 : Record 5911;
      ServLoanerMgt@1007 : Codeunit 5901;
      FaultAreaCodeVisible@19067961 : Boolean INDATASET;
      SymptomCodeVisible@19078417 : Boolean INDATASET;
      FaultCodeVisible@19037502 : Boolean INDATASET;
      ResolutionCodeVisible@19021279 : Boolean INDATASET;

    LOCAL PROCEDURE RegisterServInvLines@4();
    VAR
      ServInvLine@1000 : Record 5902;
      ServInvLines@1001 : Page 5905;
    BEGIN
      TESTFIELD("Document No.");
      TESTFIELD("Line No.");
      CLEAR(ServInvLine);
      ServInvLine.SETRANGE("Document Type","Document Type");
      ServInvLine.SETRANGE("Document No.","Document No.");
      ServInvLine.FILTERGROUP(2);
      CLEAR(ServInvLines);
      ServInvLines.Initialize("Line No.");
      ServInvLines.SETTABLEVIEW(ServInvLine);
      ServInvLines.RUNMODAL;
      ServInvLine.FILTERGROUP(0);
    END;

    LOCAL PROCEDURE ShowServOrderWorksheet@5();
    VAR
      ServItemLine@1000 : Record 5901;
    BEGIN
      TESTFIELD("Document No.");
      TESTFIELD("Line No.");

      CLEAR(ServItemLine);
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","Document No.");
      ServItemLine.FILTERGROUP(2);
      ServItemLine.SETRANGE("Line No.","Line No.");
      PAGE.RUNMODAL(PAGE::"Service Item Worksheet",ServItemLine);
      ServItemLine.FILTERGROUP(0);
    END;

    PROCEDURE AllocateResource@6();
    VAR
      ServOrderAlloc@1000 : Record 5950;
      ResAlloc@1001 : Page 6005;
    BEGIN
      TESTFIELD("Document No.");
      TESTFIELD("Line No.");
      ServOrderAlloc.RESET;
      ServOrderAlloc.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
      ServOrderAlloc.FILTERGROUP(2);
      ServOrderAlloc.SETFILTER(Status,'<>%1',ServOrderAlloc.Status::Canceled);
      ServOrderAlloc.SETRANGE("Document Type","Document Type");
      ServOrderAlloc.SETRANGE("Document No.","Document No.");
      ServOrderAlloc.FILTERGROUP(0);
      ServOrderAlloc.SETRANGE("Service Item Line No.","Line No.");
      IF ServOrderAlloc.FINDFIRST THEN;
      ServOrderAlloc.SETRANGE("Service Item Line No.");
      CLEAR(ResAlloc);
      ResAlloc.SETRECORD(ServOrderAlloc);
      ResAlloc.SETTABLEVIEW(ServOrderAlloc);
      ResAlloc.SETRECORD(ServOrderAlloc);
      ResAlloc.RUN;
    END;

    LOCAL PROCEDURE ReceiveLoaner@11();
    BEGIN
      ServLoanerMgt.ReceiveLoaner(Rec);
    END;

    LOCAL PROCEDURE ShowServItemLog@13();
    VAR
      ServItemLog@1000 : Record 5942;
    BEGIN
      TESTFIELD("Service Item No.");
      CLEAR(ServItemLog);
      ServItemLog.SETRANGE("Service Item No.","Service Item No.");
      PAGE.RUNMODAL(PAGE::"Service Item Log",ServItemLog);
    END;

    LOCAL PROCEDURE ShowChecklist@3();
    VAR
      TblshtgHeader@1000 : Record 5943;
    BEGIN
      TblshtgHeader.ShowForServItemLine(Rec);
    END;

    LOCAL PROCEDURE SelectFaultResolutionCode@15();
    VAR
      ServSetup@1000 : Record 5911;
      FaultResolutionRelation@1001 : Page 5930;
    BEGIN
      ServSetup.GET;
      CASE ServSetup."Fault Reporting Level" OF
        ServSetup."Fault Reporting Level"::None:
          ERROR(
            Text000,
            ServSetup.FIELDCAPTION("Fault Reporting Level"),
            ServSetup."Fault Reporting Level",ServSetup.TABLECAPTION);
      END;
      CLEAR(FaultResolutionRelation);
      FaultResolutionRelation.SetDocument(DATABASE::"Service Item Line","Document Type","Document No.","Line No.");
      FaultResolutionRelation.SetFilters("Symptom Code","Fault Code","Fault Area Code","Service Item Group Code");
      FaultResolutionRelation.RUNMODAL;
      CurrPage.UPDATE(FALSE);
    END;

    LOCAL PROCEDURE CreatePriceAdjmt@8();
    VAR
      ServPriceMgmt@1000 : Codeunit 6080;
    BEGIN
      ServPriceMgmt.ShowPriceAdjustment(Rec);
    END;

    PROCEDURE CreateServiceItem@9();
    VAR
      Item@1001 : Record 27;
      ServItemMgt@1000 : Codeunit 5920;
    BEGIN
      IF Item.GET("Item No.") THEN
        IF (Item."Replenishment System" <> Item."Replenishment System"::"Prod. Order") AND Warranty THEN
          TESTFIELD("Vendor No.");
      ServItemMgt.CreateServItemOnServItemLine(Rec);
    END;

    LOCAL PROCEDURE GetStdServiceCodes@12();
    VAR
      StdServItemGrCode@1000 : Record 5998;
    BEGIN
      StdServItemGrCode.InsertServiceLines(Rec);
    END;

    BEGIN
    END.
  }
}

